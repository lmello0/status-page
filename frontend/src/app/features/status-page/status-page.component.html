<div class="relative min-h-screen overflow-x-hidden bg-slate-950 text-slate-100">
  <div class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(circle_at_20%_15%,rgba(6,182,212,0.25),transparent_40%),radial-gradient(circle_at_80%_0%,rgba(56,189,248,0.18),transparent_35%),linear-gradient(160deg,#020617_0%,#0f172a_45%,#020617_100%)]"></div>
  <div class="pointer-events-none absolute inset-0 -z-10 bg-[linear-gradient(rgba(148,163,184,0.08)_1px,transparent_1px),linear-gradient(90deg,rgba(148,163,184,0.06)_1px,transparent_1px)] [background-size:42px_42px] [mask-image:radial-gradient(circle_at_center,black,transparent_90%)]"></div>

  <main class="mx-auto w-full max-w-5xl px-4 py-10 sm:px-6 lg:py-14">
    <section class="rounded-3xl border border-white/10 bg-slate-900/45 p-6 shadow-2xl shadow-black/35 backdrop-blur-md sm:p-8">
      <header class="space-y-4">
        <p class="inline-flex rounded-full border border-cyan-200/30 bg-cyan-400/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.16em] text-cyan-100">
          Service health
        </p>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h1 class="font-display text-3xl font-semibold tracking-tight text-white sm:text-4xl">
              Status Overview
            </h1>
            <p class="mt-2 max-w-2xl text-sm text-slate-300 sm:text-base">
              Track product and component health in real time with fast search and expandable details.
            </p>
          </div>
          <div class="flex flex-col items-start gap-2 sm:items-end">
            <p class="text-sm font-medium text-slate-300">{{ summary() }}</p>
            <button
              type="button"
              class="rounded-lg border border-cyan-300/40 bg-cyan-500/10 px-3 py-2 text-xs font-semibold uppercase tracking-[0.08em] text-cyan-100 transition hover:bg-cyan-400/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400"
              (click)="onAddProduct()"
            >
              Add Product
            </button>
          </div>
        </div>
      </header>

      <div class="mt-6">
        <app-status-search [value]="query()" (valueChange)="onQueryChange($event)" />
      </div>

      <div class="mt-6">
        @if (showInitialLoading()) {
          <app-state-panel kind="loading" />
        } @else if (error()) {
          <app-state-panel kind="error" [message]="error()" (action)="onRetry()" />
        } @else if (showEmpty()) {
          <app-state-panel kind="empty" />
        } @else {
          <app-product-tree
            [products]="filteredItems()"
            [expandedProductIds]="expandedProductIds()"
            (toggled)="onToggleProduct($event)"
            (editProduct)="onEditProduct($event)"
            (removeProduct)="onRemoveProduct($event)"
            (addComponent)="onAddComponent($event)"
            (editComponent)="onEditComponent($event)"
            (removeComponent)="onRemoveComponent($event)"
          />
        }
      </div>

      @if (!error() && hasMore()) {
        <div class="mt-6 flex justify-center">
          <app-load-more-button
            [loading]="isLoadingMore()"
            [disabled]="isLoading()"
            (clicked)="onLoadMore()"
          />
        </div>
      }

      @if (isProductModalOpen()) {
        <app-product-form-modal
          [mode]="productModalMode()"
          [initialValue]="productModalInitialValue()"
          [saving]="isSaving()"
          [errorMessage]="modalError()"
          (submitted)="onProductSubmit($event)"
          (cancelled)="onModalClose()"
        />
      }

      @if (isComponentModalOpen()) {
        <app-component-form-modal
          [mode]="componentModalMode()"
          [productId]="componentModalProductId()"
          [initialValue]="componentModalInitialValue()"
          [saving]="isSaving()"
          [errorMessage]="modalError()"
          (submitted)="onComponentSubmit($event)"
          (cancelled)="onModalClose()"
        />
      }

      @if (isConfirmModalOpen()) {
        <app-confirm-action-modal
          [title]="confirmModalTitle()"
          [message]="confirmModalMessage()"
          [confirmLabel]="confirmModalConfirmLabel()"
          [confirmEnabled]="confirmTargetExists()"
          [saving]="isSaving()"
          [errorMessage]="modalError()"
          (confirmed)="onConfirmRemove()"
          (cancelled)="onModalClose()"
        />
      }
    </section>
  </main>
</div>
