<article
  class="overflow-hidden rounded-2xl border border-white/10 bg-slate-900/70 shadow-xl shadow-slate-950/30 backdrop-blur-sm"
>
  <button
    type="button"
    class="cursor-pointer group w-full flex flex-1 justify-between gap-4 text-left transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400 px-5 py-4 items-center hover:bg-white/5"
    (click)="onToggle()"
    [attr.aria-expanded]="expanded()"
    [attr.aria-controls]="'product-panel-' + product().id"
  >
    <div class="flex justify-between w-full">
      <div class="min-w-0">
        <p class="font-display truncate text-lg font-semibold text-slate-100">
          {{ product().name }}
        </p>
        <p class="mt-1 line-clamp-2 text-sm text-slate-300">{{ product().description }}</p>
        <p class="mt-2 text-xs uppercase tracking-[0.14em] text-slate-400">
          {{ componentCount() }} components
        </p>
      </div>
    </div>

    <div class="flex gap-4 flex-col">
      <div class="flex items-center gap-3 justify-between">
        <app-status-badge [status]="product().status" />
        <span
          class="cursor-pointer inline-flex px-2.5 items-center justify-center rounded-full border border-white/15 text-slate-200 transition group-hover:border-cyan-300/70 group-hover:text-cyan-100"
        >
          {{ expanded() ? '-' : '+' }}
        </span>
      </div>
      <div
        class="flex shrink-0 items-center gap-1 rounded-xl border border-white/15 bg-white/5 p-1"
      >
        <button
          type="button"
          class="cursor-pointer rounded-lg px-3 py-2 text-xs font-semibold text-slate-200 transition hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400"
          data-action="edit-product"
          (click)="onEditProduct()"
        >
          Edit Product
        </button>
        <button
          type="button"
          class="cursor-pointer rounded-lg px-3 py-2 text-xs font-semibold text-rose-100 transition hover:bg-rose-400/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-400"
          data-action="remove-product"
          (click)="onRemoveProduct()"
        >
          Remove Product
        </button>
      </div>
    </div>
  </button>

  @if (expanded()) {
    <div
      class="border-t border-white/10 bg-slate-950/40 px-5 py-4"
      [id]="'product-panel-' + product().id"
      role="region"
      [attr.aria-label]="product().name + ' components'"
    >
      <div class="mb-3 flex justify-end">
        <button
          type="button"
          class="rounded-lg border border-cyan-300/40 bg-cyan-500/10 px-3 py-2 text-xs font-semibold text-cyan-100 transition hover:bg-cyan-400/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400"
          (click)="onAddComponent()"
        >
          Add Component
        </button>
      </div>

      <div class="grid gap-3 lg:grid-cols-2">
        @for (component of product().components; track component.id) {
          <app-component-status-card
            [component]="component"
            (editComponent)="onEditComponent($event)"
            (removeComponent)="onRemoveComponent($event)"
          />
        }
      </div>
    </div>
  }
</article>
